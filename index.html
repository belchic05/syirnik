<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syrnik: The Sadness</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            font-family: 'Georgia', serif; /* Шрифт ещё строже */
        }

        /* Дождь */
        #rain-canvas {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1;
            opacity: 0.3; 
        }

        /* Виньетка - теперь она постоянная часть атмосферы */
        #vignette {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 5;
            background: radial-gradient(circle, transparent 25%, rgba(0,0,0,0.9) 85%);
            pointer-events: none;
        }

        /* Сцена */
        #stage {
            position: relative;
            z-index: 2;
            width: 400px;
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #syrnik-img {
            width: 300px;
            height: auto;
            display: block;
            /* Максимальный нуар */
            filter: grayscale(100%) contrast(120%) brightness(0.7);
            /* Важно: origin внизу, чтобы он "оседал" на землю */
            transform-origin: center bottom; 
            will-change: transform;
        }

        /* Кнопка - еле заметная */
        #start-btn {
            position: absolute;
            z-index: 10;
            background: transparent;
            color: #444; /* Темно-серый цвет */
            border: 1px solid #333; /* Очень тусклая рамка */
            padding: 15px 30px;
            font-family: 'Georgia', serif;
            font-size: 12px;
            letter-spacing: 4px;
            text-transform: lowercase;
            cursor: pointer;
            transition: all 0.8s ease;
        }

        #start-btn:hover {
            color: #888;
            border-color: #666;
            box-shadow: 0 0 10px rgba(255,255,255,0.05);
        }

    </style>
</head>
<body>

    <div id="vignette"></div>
    <canvas id="rain-canvas"></canvas>

    <div id="stage">
        <img src="syrnik.webp" id="syrnik-img" alt="Sad Syrnik">
    </div>

    <button id="start-btn">accept fate</button>
    <audio id="audioPlayer" src="music.mp3" loop></audio>

    <script>
        // --- Дождь (без изменений, он хорош) ---
        const canvas = document.getElementById('rain-canvas');
        const ctx = canvas.getContext('2d');
        let width = canvas.width = window.innerWidth;
        let height = canvas.height = window.innerHeight;
        const drops = [];
        class Drop {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * width;
                this.y = Math.random() * -height;
                this.speed = Math.random() * 4 + 4;
                this.len = Math.random() * 20 + 10;
                this.opacity = Math.random() * 0.3 + 0.1;
            }
            draw() {
                this.y += this.speed;
                if (this.y > height) this.reset();
                ctx.beginPath();
                ctx.strokeStyle = `rgba(100, 100, 120, ${this.opacity})`;
                ctx.lineWidth = 1;
                ctx.moveTo(this.x, this.y);
                ctx.lineTo(this.x, this.y + this.len);
                ctx.stroke();
            }
        }
        for (let i = 0; i < 100; i++) drops.push(new Drop());
        function animateRain() {
            ctx.clearRect(0, 0, width, height);
            drops.forEach(drop => drop.draw());
            requestAnimationFrame(animateRain);
        }
        animateRain();

        // --- Логика Анимации ---
        const startBtn = document.getElementById('start-btn');
        const audioPlayer = document.getElementById('audioPlayer');
        const syrnik = document.getElementById('syrnik-img');
        
        let audioContext, analyser, source;
        let isPlaying = false;

        startBtn.addEventListener('click', () => {
            if (isPlaying) return;
            
            // Кнопка растворяется в небытие
            startBtn.style.opacity = '0';
            setTimeout(() => startBtn.style.display = 'none', 2000);

            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            
            // smoothingTimeConstant = 0.9 делает реакцию очень плавной, "вязкой"
            analyser.smoothingTimeConstant = 0.9; 
            analyser.fftSize = 2048;

            source = audioContext.createMediaElementSource(audioPlayer);
            source.connect(analyser);
            analyser.connect(audioContext.destination);

            audioPlayer.play();
            isPlaying = true;
            renderFrame();
        });

        function renderFrame() {
            requestAnimationFrame(renderFrame);

            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteFrequencyData(dataArray);

            // Получаем уровень баса (0-255)
            let bassSum = 0;
            for (let i = 0; i < 8; i++) bassSum += dataArray[i];
            let bassAvg = bassSum / 8;

            // Нормализуем силу удара (0.0 до 1.0)
            const beatForce = bassAvg / 255;

            // --- 1. Меланхоличное покачивание ---
            // Используем синус от времени. Это движение не зависит от музыки.
            // Сырник качается как маятник часов.
            const time = Date.now() * 0.001; // время в секундах
            const sway = Math.sin(time) * 4; // Качается на 4 градуса влево-вправо

            // --- 2. Тяжелый вздох (реакция на бит) ---
            // Вместо того чтобы расти (scale > 1), он будет "оседать" под тяжестью
            
            // Сплющивание по вертикали (становится ниже)
            // Чем сильнее бит, тем меньше Y (до 0.9)
            const scaleY = 1 - (beatForce * 0.15); 
            
            // Расширение по горизонтали (компенсация, эффект желе)
            // Чем сильнее бит, тем шире X (до 1.05)
            const scaleX = 1 + (beatForce * 0.05);

            // Смещение вниз (он физически опускается)
            const translateY = beatForce * 15; // Опускается на 15 пикселей вниз

            // --- Применяем ---
            syrnik.style.transform = `
                translateY(${translateY}px)
                rotate(${sway}deg)
                scale(${scaleX}, ${scaleY})
            `;
            
            // Немного затемняем его на ударе (свет гаснет)
            syrnik.style.filter = `grayscale(100%) contrast(120%) brightness(${0.7 - beatForce * 0.2})`;
        }
    </script>
</body>
</html>
